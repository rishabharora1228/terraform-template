  parameters:
  - name: version
    displayName: Terraform version
    type: boolean
    default: 'latest'
    values:
    - 1.3.6
    - 1.3.5
    - 1.1
  
  steps:
  
  - task: ms-devlabs.custom-terraform-tasks.custom-terraform-installer-task.TerraformInstaller@0
    displayName: Terraform installation
    inputs:
         terraformVersion: ${{ parameters.version }}
        
  - task: TerraformTaskV3@3
    displayName: Terraform init  
    inputs:
      provider: 'azurerm'
      command: 'init'
      backendServiceArm: 'ot-microservices'
      backendAzureRmResourceGroupName: 'ot-test'
      backendAzureRmStorageAccountName: 'terra139'
      backendAzureRmContainerName: 'terraform'
      backendAzureRmKey: 'terraform.tfstate'
  - task: TerraformTaskV3@3
    displayName: Validate
    inputs:
      provider: 'azurerm'
      command: 'validate'
  - task: TerraformTaskV3@3
    displayName: Terraform Plan
    inputs:
      provider: 'azurerm'
      command: 'plan'
      commandOptions: '--out=plan.tfplan'
      environmentServiceNameAzureRM: 'Free Trial(5ff7175a-050e-4ea4-b68a-1561ca20211b)'
