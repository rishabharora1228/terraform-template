 parameters: 
      rmkey: terraform.tfvars
  
  steps:
  
  - task: ms-devlabs.custom-terraform-tasks.custom-terraform-installer-task.TerraformInstaller@0
    displayName: Terraform installation
    inputs:
         terraformVersion: 'latest'
        
  - task: TerraformTaskV3@3
    displayName: Terraform init  
    inputs:
      provider: 'azurerm'
      command: 'init'
      backendServiceArm: 'ot-microservices'
      backendAzureRmResourceGroupName: 'ot-test'
      backendAzureRmStorageAccountName: 'terra139'
      backendAzureRmContainerName: 'terraform'
      backendAzureRmKey: ${{ parameters.rmkey }}
  - task: TerraformTaskV3@3
    displayName: Validate
    inputs:
      provider: 'azurerm'
      command: 'validate'
  - task: TerraformTaskV3@3
    displayName: Terraform Plan
    inputs:
      provider: 'azurerm'
      command: 'plan'
      commandOptions: '--out=plan.tfplan'
      environmentServiceNameAzureRM: 'Free Trial(5ff7175a-050e-4ea4-b68a-1561ca20211b)'
